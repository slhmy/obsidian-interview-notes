## 定义

数据库事务是一个被数据库管理系统（DBMS）视为**单一逻辑工作单元的操作序列**。

## ACID

事务主要**遵循**四个原则，通常被称为ACID原则：

**Atomicity / Consistency / Isolation / Durability**

- **原子性**：事务作为一个整体被执行，包括在其内部的所有操作。要么全部执行，要么全部不执行。
- **一致性**：事务应确保数据库从一个一致的状态转变为另一个一致的状态。
- **隔离性**：并发执行的事务彼此隔离，不会互相影响。
- **持久性**：一旦事务完成，其结果就会永久保存在数据库中。

## 生命周期

事务的生命周期通常包括以下几个阶段：

1. **开始**：事务开始时，系统会记录事务的开始状态，并对相关数据进行加锁，以防止其他并发事务对数据进行修改。
2. **执行**：在事务执行期间，会执行一系列的数据操作，如插入、更新或删除数据。
3. **提交或回滚**：根据事务的执行结果，决定是提交事务（将所有的修改永久保存到数据库中）还是回滚事务（撤销所有的修改，恢复到事务开始前的状态）。
4. **结束**：事务完成后，系统会释放相关的资源，如锁等。

如果 SQL 写出来…

```sql
-- 开始事务
START TRANSACTION;

-- 执行数据操作
UPDATE accounts SET balance = balance - 100 WHERE account_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE account_id = 2;

-- 判断事务是否成功
IF (ERROR) {
    -- 事务失败，回滚
    ROLLBACK;
} ELSE {
    -- 事务成功，提交
    COMMIT;
}
```

## AUTOCOMMIT

MySQL / PostgreSQL / Oracle / SQL Server 中的一个系统变量（默认情况下是启用的）。

如果启用，**每个单独的数据库操作**（如：INSERT，UPDATE，DELETE）**都会立即被提交**。

> [!tip] 
> MongoDB 中，**单个的写操作是原子的**，因此它没有类似于 Auto commit 的概念。